local SPIN_FRAMES = 3
local FRAME_DELAY = 2
local COOLDOWN = 15
local EMOJIS = {"🍋","🍒","🍇","🍉","🤑","🐴","💎"}

local Players = game:GetService("Players")
local Rep = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local TextChatService = game:GetService("TextChatService")
local UIS = game:GetService("UserInputService")
local lp = Players.LocalPlayer

local function buildSender()
    
    if TextChatService and TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        -- RBXGeneral kanalını bekle
        local channels = TextChatService:WaitForChild("TextChannels", 5)
        if channels then
            local general
            local t0 = os.clock()
            repeat
                general = channels:FindFirstChild("RBXGeneral")
                if not general then task.wait(0.1) end
            until general or os.clock() - t0 > 5
            if general then
                return function(msg)
                    general:SendAsync(msg)
                end
            end
        end
    end
    
    local chatEvents = Rep:FindFirstChild("DefaultChatSystemChatEvents")
    if chatEvents and chatEvents:FindFirstChild("SayMessageRequest") then
        local say = chatEvents.SayMessageRequest
        return function(msg)
            say:FireServer(msg, "All")
        end
    end
   
    return function(msg)
        pcall(function()
            StarterGui:SetCore("ChatMakeSystemMessage", {Text = msg})
        end)
    end
end

local send = buildSender()

local lastSpin = 0

local function randomRoll()
    return {
        EMOJIS[math.random(#EMOJIS)],
        EMOJIS[math.random(#EMOJIS)],
        EMOJIS[math.random(#EMOJIS)]
    }
end

local function toLine(t)
    return string.format("%s | %s | %s", t[1], t[2], t[3])
end

local function score(roll)
    if roll[1]==roll[2] and roll[2]==roll[3] then
        return "jackpot", roll[1]
    elseif roll[1]==roll[2] or roll[1]==roll[3] or roll[2]==roll[3] then
        return "small", roll[1]
    else
        return "lose", nil
    end
end

local function spinSlot()
    local now = os.clock()
    if now - lastSpin < COOLDOWN then
        local left = math.max(0, COOLDOWN - (now - lastSpin))
        send(string.format("Cooldown... %.1fs", left))
        return
    end
    lastSpin = now

    send("gl")

    for i=1, SPIN_FRAMES do
        send(toLine(randomRoll()))
        task.wait(FRAME_DELAY)
    end

    task.wait(0.35)
    local final = randomRoll()
    send("—")

    local result, symbol = score(final)
    if result == "jackpot" then
        if symbol == "🤑" then
            send("💎✨ GRRR JACKPOT!!! ✨💎")
        else
            send("🎉💎 JACKPOT!!! 💎🎉")
        end
    elseif result == "small" then
        send("🤓🌟Small Win!!🌟🤓")
    else
        send("😂❌YOU GOT NOTHING❌😂")
    end
end

-- ====== KISAYOL (PC) ======
UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.Z then
        spinSlot()
    end
end)

-- ====== BASİT GUI (Mobil + PC) ======
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SlotGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = lp:WaitForChild("PlayerGui")

local Button = Instance.new("TextButton")
Button.Parent = ScreenGui
Button.Size = UDim2.new(0, 120, 0, 40)
Button.Position = UDim2.new(1, -130, 0.5, -20) -- sağ orta
Button.BackgroundColor3 = Color3.fromRGB(20,20,20)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.Text = "SLOT 🤑"
Button.Font = Enum.Font.GothamBold
Button.TextSize = 20
Button.BorderSizePixel = 0
Button.AutoButtonColor = true
Button.ClipsDescendants = true

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = Button

Button.MouseButton1Click:Connect(spinSlot)
